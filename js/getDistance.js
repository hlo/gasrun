var input=document.getElementById("destinationInput"),mapCanvas=document.getElementById("map_canvas"),distanceOneWay=document.getElementById("distanceOneWay"),duration=document.getElementById("duration"),destinationAddress=document.getElementById("destinationAddress"),turnByTurnDirection=document.getElementById("turnByTurnDirections"),directionsService=new google.maps.DirectionsService(),directionsDisplay=new google.maps.DirectionsRenderer(),locator=new google.maps.Geocoder(),destinationPlace,oneWayDistance,oneWayResponse,autocomplete,origin,self;function initialize(){origin=require("js/getCurrentPosition");var a={location:require("js/getCurrentPosition").returnCurrentLatLng(),};autocomplete=new google.maps.places.Autocomplete(input,a);google.maps.event.addListener(autocomplete,"place_changed",function(){getDistanceToDestination()})}function getDistanceToDestination(){destinationPlace=autocomplete.getPlace()}function directionInitialize(){directionsDisplay=new google.maps.DirectionsRenderer();mapOptions={zoom:15,center:origin.returnCurrentLatLng(),};map=new google.maps.Map(mapCanvas,mapOptions);directionsDisplay.setMap(map);calculateRoute()}function calculateRoute(){var c=origin.returnCurrentAddress();var a;if(destinationPlace===undefined){a=input.value}else{a=destinationPlace.formatted_address}var b={origin:c,destination:a,travelMode:google.maps.TravelMode.DRIVING,avoidTolls:true};directionsService.route(b,function(e,d){if(d==google.maps.DirectionsStatus.OK){oneWayResponse=e;oneWayDistance=oneWayResponse.routes[0].legs[0].distance.value/1000;b={origin:a,destination:c,travelMode:google.maps.TravelMode.DRIVING};directionsService.route(b,function(g,f){if(f==google.maps.DirectionsStatus.OK){calculateCost.sendDistance(oneWayDistance,g.routes[0].legs[0].distance.value/1000);calculateCost.calculateTotalCost();directionsDisplay.setDirections(oneWayResponse);turnByTurnDirection.innerHTML='<a href="http://maps.google.com/maps?saddr=”'+c+"”&daddr=”"+a+'" target="_blank">Turn-by-turn Directions</a>'}else{alert("Error: unable to get route")}})}else{alert("Error: unable to get route")}})}function returnDestinationAddress(){return destinationPlace.formatted_address}self={initialize:initialize,returnDestinationAddress:returnDestinationAddress,directionInitialize:directionInitialize,};exports=self;