var makeArray=new Array(),make,model,year,avgMpg,self;function clearDropDown(b,d,c){if(b){document.getElementById("model").innerHTML='<option value="" disabled selected>Model</option>';$("#model").fadeOut()}if(d){document.getElementById("year").innerHTML='<option value="" disabled selected>Year</option>';$("#year").fadeOut()}if(c){document.getElementById("avgKml").innerHTML="";$("#vehicleInfo").fadeOut();$("#avgMpg").fadeOut()}}function getCarMake(){$("#dropDowns").append("<img class='load' src='img/loadingGif.gif' width='20' height='20'/>");ajax.sendToPython("getMake","make")}function getCarModel(a){clearDropDown(1,1,1);make=a;require("js/ajaxRequest").sendToPython("makeM:"+make,"model")}function getCarYear(a){clearDropDown(0,1,1);model=a;require("js/ajaxRequest").sendToPython("makeY:"+make+":model:"+model,"year")}function getAvgMpg(a){clearDropDown(0,0,1);year=a;require("js/ajaxRequest").sendToPython("makeMpg:"+make+":model:"+model+":year:"+year,"avgMpg")}function parseAndUpdateCarMake(a){makeArray=a.replace(/[\[\]\']+/g,"").split('"getMake"')[1].replace(/(\r\n|\n|\r)/gm,"").replace(/, /g,"/").split("/");for(i in makeArray){document.getElementById("make").add(new Option(makeArray[i]))}$("#make").fadeIn()}function parseAndUpdateCarModel(a){modelArray=a.replace(/[\[\]\']+/g,"").split('"makeM:'+make+'"')[1].replace(/(\r\n|\n|\r)/gm,"").replace(/, /g,";").split(";");for(i in modelArray){document.getElementById("model").add(new Option(modelArray[i]))}$("#model").fadeIn()}function parseAndUpdateCarYear(a){yearArray=a.replace(/u\'/g,"").replace(/[\[\]\']+/g,"").split('"makeY:'+make+":model:"+model+'"')[1].replace(/(\r\n|\n|\r)/gm,"").replace(/, /g,";").split(";");uniqueYear=[];$.each(yearArray,function(b,c){if($.inArray(c,uniqueYear)===-1){uniqueYear.push(c)}});uniqueYear.forEach(function(b){document.getElementById("year").add(new Option(b))});$("#year").fadeIn()}function parseAvgMpg(a){total=0;count=0;avgMsgArray=a.replace(/u\'/g,"").replace(/[\[\]\']+/g,"").split('"makeMpg:'+make+":model:"+model+":year:"+year+'"')[1].replace(/(\r\n|\n|\r)/gm,"").replace(/, /g,";").split(";");avgMsgArray.forEach(function(b){total=total+parseFloat(b);count=count+1});avgMpg=total/count;calculateCost.sendAvgMpg(avgMpg);document.getElementById("avgKml").innerHTML="average KM/L <strong>"+Math.round((0.425143707*avgMpg)*100)/100+"</strong>";document.getElementById("vehicleInfo").innerHTML=year+" "+make+" "+model;$("#vehicleInfo").fadeIn();$("#avgMpg").fadeIn()}self={getCarMake:getCarMake,getCarModel:getCarModel,getCarYear:getCarYear,getAvgMpg:getAvgMpg,parseAndUpdateCarMake:parseAndUpdateCarMake,parseAndUpdateCarModel:parseAndUpdateCarModel,parseAndUpdateCarYear:parseAndUpdateCarYear,parseAvgMpg:parseAvgMpg,};exports=self;